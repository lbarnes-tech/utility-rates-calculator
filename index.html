<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utility Rate Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 0px;
        }

        .warning-box {
            border: 2px solid;
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 20px;
            border-color: orange;
            background-color: #fffdef;
        }

        .warning-box p {
            padding: .5rem 0;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            color: #1e293b;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        .header p {
            color: #64748b;
            font-size: 1.1rem;
        }

        .graphs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }

        .card h2 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #1e293b;
        }

        .canvas-container {
            position: relative;
            height: 300px;
        }

        .calculator-section {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }

        .calculator-section h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #1e293b;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .rate-container {
            display: flex;
            justify-content: space-between;
        }

        .rate-graph {
            width: 48%;
        }

        .rate-info {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1rem;
            width: 48%;
        }



        @media (max-width: 1024px) {

            .rate-container {
                flex-direction: column;
                gap: 20px;
            }

            .rate-info,
            .rate-graph {
                width: 100%;
            }


            .calculator-grid {
                grid-template-columns: 1fr;
            }

            .graphs-grid {
                grid-template-columns: 1fr;
            }
        }

        .input-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .utility-card {
            border: 2px solid;
            border-radius: 0.75rem;
            padding: 1.25rem;
        }

        .location-card {
            border-color: lightgreen;
            background-color: #effff1;
        }

        .electric-card {
            border-color: #fbbf24;
            background-color: #fffbeb;
        }

        .water-card {
            border-color: #60a5fa;
            background-color: #eff6ff;
        }

        .utility-card h3 {
            font-size: 1.125rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.625rem 0.875rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .help-text {
            font-size: .8rem;
            font-style: italic;
            color: #6b7280;
            padding: 0.25rem 0 .75rem 0;
        }

        .results-section {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .results-card {
            background: linear-gradient(135deg, #eef2ff 0%, #f3e8ff 100%);
            border: 2px solid #a5b4fc;
            border-radius: 0.75rem;
            padding: 1.5rem;
        }

        .results-card h3 {
            font-size: 1.125rem;
            margin-bottom: 1rem;
            color: #312e81;
        }

        .bill-item {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #c7d2fe;
        }

        .bill-item:last-of-type {
            margin-bottom: 1rem;
        }

        .bill-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .bill-label {
            font-weight: 500;
        }

        .bill-amount {
            font-size: 1.25rem;
            font-weight: bold;
        }

        .electric-color {
            color: #d97706;
        }

        .tax-color {
            color: darkgoldenrod;
        }

        .water-color {
            color: #2563eb;
        }

        .sewer-color {
            color: #059669;
        }

        .equation-box {
            background: white;
            border-radius: 0.5rem;
            padding: 0.75rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            color: #374151;
            overflow-x: auto;
        }

        .total-bill {
            background: #4f46e5;
            color: white;
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-top: 1rem;
        }

        .total-bill-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .total-bill-label {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .total-bill-amount {
            font-size: 2rem;
            font-weight: bold;
        }

        .total-breakdown {
            margin-top: 0.5rem;
            font-size: 0.875rem;
            opacity: 0.9;
        }



        .rate-info h4 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        .rate-info-list {
            font-size: 1.25rem;
            display: flex;
            flex-direction: column;
            gap: .25rem;
        }

        .icon {
            width: 24px;
            height: 24px;
        }

        .icon-sm {
            width: 20px;
            height: 20px;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="container">
            <div class="header">
                <h1>
                    Utility Rate Tracker
                </h1>
            </div>

            <div class="warning-box">
                <h3>
                    This webpage is not affiliated with, created by, or endorsed by the Town of Apex.
                </h3>
                <p>These are all based on the town's fiscal years, which run from July to the next June.</p>
                <p>Please see the Town of Apex's <a href='https://apexnc.org/2014/Billing-Updates'>Billing Updates</a>
                    page for the latest information about utility bills during the transition to the new billing system.
                </p>
                <p>Also, please refer to the Town of Apex's <a href='https://apexnc.org/2068/Third-Party-Review#'>Third
                        Party
                        Review</a> page for information about the transitional bills in July, August, and September of
                    2024.</p>
                <p>
                    There are nuances such as solar usage, the highest tier of stormwater fee, and time-of-year-based,
                    usage-based electricity billing prior
                    to Fiscal Year 2022 that are not fully captured here. If this tool gets a lot of traction or I get
                    more time, I will look at adding those.
                </p>
                <p>
                    I mostly made this because going through and mapping the utility bill to usage and rates was tricky,
                    even for me as an engineer. When I was able to get a spreadsheet set up with the math, it did match
                    with my expectations, so I made this to give others that same ability to get a gut check on their
                    utility bill.
                </p>
                <p>I pulled all the fee schedules from the <a href='https://www.apexnc.org/153/Budget'>budget
                        reports</a> available on the Town of Apex website. If you have a question, or think I typoed
                    something, you can email me at lrridge (at) gmail (dot) com.</p>
                <p>This site does not store any information - everything is calculated within the page locally.</p>
            </div>

            <div class="calculator-section">
                <h2>
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <rect x="4" y="2" width="16" height="20" rx="2" />
                        <line x1="8" y1="6" x2="16" y2="6" />
                        <line x1="16" y1="14" x2="16" y2="18" />
                        <path d="M16 10h.01" />
                        <path d="M12 10h.01" />
                        <path d="M8 10h.01" />
                        <path d="M12 14h.01" />
                        <path d="M8 14h.01" />
                        <path d="M8 18h.01" />
                    </svg>
                    Bill Calculator
                </h2>

                <div class="calculator-grid">
                    <div class="input-section">
                        <div class="utility-card location-card">
                            <h3>
                                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                                    <polyline points="9 22 9 12 15 12 15 22" />
                                </svg>
                                Location
                            </h3>
                            <div class="form-group">
                                <label>Inside or Outside Town Limits</label>
                                <select v-model="location">
                                    <option value="inside">Inside</option>
                                    <option value="outside">Outside</option>
                                </select>
                                <div class="help-text">Base rates for water and sewer are increased outside of town
                                    limits.</div>
                                <label>House Type</label>
                                <select v-model="houseType">
                                    <option value="pays_stormwater">Single Family Detached, Duplex, Manufactured Home on
                                        Individual Lot</option>
                                    <option value="no_stormwater">Townhome, Apartment, Condo, Manufactured Home on
                                        Shared Lot, Other</option>
                                </select>
                                <div class="help-text">Only single family detached homes, duplexes, and manufactured
                                    homes on individual lots pay stormwater fees.</div>
                                <div v-if="houseType === 'pays_stormwater'">
                                    <label>Impermeable Surface Size (House Footprint, Garage Footprint, Patio,
                                        etc.)</label>
                                    <select v-model="houseSize">
                                        <option value="tier1">400-1,500 square feet</option>
                                        <option value="tier2">1,500-3,000 square feet</option>
                                        <option value="tier3">3,000-4,000 square feet</option>
                                        <option value="tier4">&gt;4,000 square feet</option>
                                    </select>
                                    <div class="help-text">Tiered rates based on impermeable surface square footage.
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="utility-card electric-card">
                            <h3>
                                <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2">
                                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
                                </svg>
                                Electric Usage
                            </h3>
                            <p>Enter what is under the <strong>Usage</strong> column for the <strong>Electric
                                </strong>row on your bill.</p>
                            <br>
                            <div class="form-group">
                                <label>Usage Type</label>
                                <select v-model="usageType">
                                    <option value="flat">Flat Rate</option>
                                    <option value="tiered">Peak/Off-Peak</option>
                                </select>
                            </div>

                            <div v-show="flatElectricalUsage" class="form-group">
                                <label>Usage (kWh)</label>
                                <input type="number" v-model.number="flatUsage" placeholder="4000" v-on:change="refreshCharts">
                            </div>
                            <div class="form-group" v-show="tieredElectricalUsage">
                                <label>Peak Usage (kWh)</label>
                                <input type="number" v-model.number="peakUsage" placeholder="1000"  v-on:change="refreshCharts">
                            </div>
                            <div class="form-group" v-show="tieredElectricalUsage">
                                <label>Off-Peak Usage (kWh)</label>
                                <input type="number" v-model.number="offPeakUsage" placeholder="3000"  v-on:change="refreshCharts">
                            </div>
                        </div>

                        <div class="utility-card water-card">
                            <h3>
                                <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2">
                                    <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z" />
                                </svg>
                                Water Usage
                            </h3>
                            <p>Enter what is under the <strong>Usage</strong> column for the <strong>Water </strong>row
                                on your bill. Water usage is used for both water and sewer calculations.</p>
                            <br>
                            <div class="form-group">
                                <label>Usage (gallons)</label>
                                <input type="number" v-model.number="waterUsage" placeholder="3000"  v-on:change="refreshCharts">
                                <div class="help-text">If you use, for example, 9,000 gallons, the first 6,000 are
                                    billed at Tier 1, and the remaining 3,000 are billed at Tier 2.</div>
                            </div>
                        </div>

                    </div>

                    <div class="results-section">
                        <div class="results-card">
                            <h3>Estimated Bill</h3>

                            <div class="bill-item">
                                <div class="bill-header">
                                    <span class="bill-label electric-color">Electric</span>
                                    <span class="bill-amount electric-color">${{ electricBill.toFixed(2) }}</span>
                                </div>
                                <div class="equation-box">
                                    {{ electricEquation }} = ${{ electricBill.toFixed(2) }}
                                </div>
                            </div>
                            <div class="bill-item">
                                <div class="bill-header">
                                    <span class="bill-label tax-color">Electric Sales Tax</span>
                                    <span class="bill-amount tax-color">${{ salesTaxBill.toFixed(2) }}</span>
                                </div>
                                <div class="equation-box">
                                    {{ salesTaxEquation }} = ${{ salesTaxBill.toFixed(2) }}
                                </div>
                            </div>
                            <div class="bill-item">
                                <div class="bill-header">
                                    <span class="bill-label water-color">Water</span>
                                    <span class="bill-amount water-color">${{ waterBill.toFixed(2) }}</span>
                                </div>
                                <div class="equation-box">
                                    {{ waterEquation }} = ${{ waterBill.toFixed(2) }}
                                </div>
                            </div>

                            <div class="bill-item">
                                <div class="bill-header">
                                    <span class="bill-label sewer-color">Sewer</span>
                                    <span class="bill-amount sewer-color">${{ sewerBill.toFixed(2) }}</span>
                                </div>
                                <div class="equation-box">
                                    {{ sewerEquation }} = ${{ sewerBill.toFixed(2) }}
                                </div>
                            </div>

                            <div class="bill-item">
                                <div class="bill-header">
                                    <span class="bill-label" style="color: #ff5747;">Garbage</span>
                                    <span class="bill-amount" style="color: #ff5747;">${{ garbageBill.toFixed(2)
                                        }}</span>
                                </div>
                                <div class="equation-box">
                                    {{ garbageEquation }}
                                </div>
                            </div>

                            <div class="bill-item">
                                <div class="bill-header">
                                    <span class="bill-label" style="color: #7c3aed;">Recycling</span>
                                    <span class="bill-amount" style="color: #7c3aed;">${{ recyclingBill.toFixed(2)
                                        }}</span>
                                </div>
                                <div class="equation-box">
                                    {{ recyclingEquation }}
                                </div>
                            </div>
                            <div class="bill-item">
                                <div class="bill-header">
                                    <span class="bill-label" style="color: #df00ad;">Yard Waste</span>
                                    <span class="bill-amount" style="color: #df00ad;">${{ yardWasteBill.toFixed(2)
                                        }}</span>
                                </div>
                                <div class="equation-box">
                                    {{ yardWasteEquation }}
                                </div>
                            </div>
                            <div class="bill-item">
                                <div class="bill-header">
                                    <span class="bill-label" style="color: #0891b2;">Stormwater</span>
                                    <span class="bill-amount" style="color: #0891b2;">${{ stormwaterBill.toFixed(2)
                                        }}</span>
                                </div>
                                <div class="equation-box">
                                    {{ stormwaterEquation }}
                                </div>
                            </div>

                            <div class="total-bill">
                                <div class="total-bill-header">
                                    <span class="total-bill-label">Total</span>
                                    <span class="total-bill-amount">${{ totalBill.toFixed(2) }}</span>
                                </div>
                                <div class="total-breakdown">
                                    ${{ electricBill.toFixed(2) }} + ${{ salesTaxBill.toFixed(2) }} + ${{
                                    waterBill.toFixed(2) }} + ${{
                                    sewerBill.toFixed(2) }} + ${{
                                    garbageBill.toFixed(2) }} + ${{
                                    recyclingBill.toFixed(2) }} + ${{
                                    yardWasteBill.toFixed(2) }} + ${{
                                    stormwaterBill.toFixed(2) }}
                                </div>
                            </div>
                        </div>



                    </div>

                </div>
            </div>

        </div>
        <div class="container rate-container">
            <div class="rate-info">
                <h4>Current Rates (2025)</h4>
                <div class="rate-info-list">
                    <div v-show="flatElectricalUsage">Electric: $<span>{{ currentRates.electricBase.toFixed(2)
                            }}</span>/bill + $<span>{{
                            currentRates.electricRate.toFixed(4) }}</span>/kWh</div>
                    <div v-show="tieredElectricalUsage">Electric: $<span>{{ currentRates.electricBase.toFixed(2)
                            }}</span>/bill + $<span>{{
                            currentRates.electricRatePeak.toFixed(4) }}</span>/kWh (Peak) + $<span>{{
                            currentRates.electricRateOffPeak.toFixed(4) }}</span>/kWh (Off-Peak) </div>
                    <div>Electricity Sales Tax: <span>{{ (this.salesTax*100).toFixed(0) }}%</span></div>
                    <div>Water: $<span>{{ this.location == 'inside' ? currentRates.waterBase.inside.toFixed(2) :
                            currentRates.waterBase.outside.toFixed(2) }}</span>/bill + Tier 1 (0-6k gal):
                        $<span>{{ currentRates.waterTier1.toFixed(2) }}</span>/kgal</div>
                    <div style="padding-left: 3.5rem;">Tier 2 (6k-12k gal): $<span>{{
                            currentRates.waterTier2.toFixed(2) }}</span>/kgal</div>
                    <div style="padding-left: 3.5rem;">Tier 3 (12k+ gal): $<span>{{ currentRates.waterTier3.toFixed(2)
                            }}</span>/kgal</div>
                    <div>Sewer: $<span>{{ this.location == 'inside' ? currentRates.sewerBase.inside.toFixed(2) :
                            currentRates.sewerBase.outside.toFixed(2) }}</span>/bill + $<span>{{
                            currentRates.sewerRate.toFixed(2) }}</span>/kgal</div>
                    <div>Garbage: $<span>{{ currentRates.garbage.toFixed(2) }}</span>/bill (flat)</div>
                    <div>Recycling: $<span>{{ currentRates.recycling.toFixed(2) }}</span>/bill (flat)</div>
                    <div>Yard Waste: $<span>{{ currentRates.yardWaste.toFixed(2) }}</span>/bill (flat)</div>
                    <div>Stormwater: $<span>{{ (this.houseType == 'no_stormwater' ? 0 : this.houseSize == 'tier1' ?
                            this.currentRates.stormwater.tier1 : this.houseSize == 'tier2' ?
                            this.currentRates.stormwater.tier2 : this.houseSize == 'tier3' ?
                            this.currentRates.stormwater.tier3 : this.currentRates.stormwater.tier4 ).toFixed(2)
                            }}</span>/bill (flat)</div>
                </div>
                <br>
                <p> These rates also take into account the information from your location selections above.</p>
            </div>
            <div class="card rate-graph">
                <h2>
                    <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                    </svg>
                    Estimated Totals Over Time
                </h2>
                <div class="canvas-container">
                    <canvas ref="sameUsageOverYearsChart"></canvas>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="graphs-grid">

                <div class="card">
                    <h2>
                        <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                        </svg>
                        Base Rates Over Time
                    </h2>
                    <div class="canvas-container">
                        <canvas ref="baseRateChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h2>
                        <svg class="icon-sm" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                        </svg>
                        Metered Rates Over Time
                    </h2>
                    <div class="canvas-container">
                        <canvas ref="meteredRateChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    rateData: [
                        { year: 'FY 2018-19', electricBase: 14.81, electricRate: 0.1012, electricRatePeak: 0.2656, electricRateOffPeak: 0.0626, waterBase: { inside: 5.54, outside: 11.08 }, waterTier1: 4.19, waterTier2: 4.82, waterTier3: 6.49, sewerBase: { inside: 9.09, outside: 18.18 }, sewerRate: 6.50, garbage: 8.30, recycling: 3.44, yardWaste: 7.83, stormwater: { tier1: 0, tier2: 0, tier3: 0, tier4: 0 } },
                        { year: 'FY 2019-20', electricBase: 15.05, electricRate: 0.1029, electricRatePeak: 0.2700, electricRateOffPeak: 0.0636, waterBase: { inside: 5.54, outside: 11.08 }, waterTier1: 4.19, waterTier2: 4.82, waterTier3: 6.49, sewerBase: { inside: 9.46, outside: 18.91 }, sewerRate: 6.76, garbage: 8.51, recycling: 4.28, yardWaste: 7.83, stormwater: { tier1: 0, tier2: 0, tier3: 0, tier4: 0 } },
                        { year: 'FY 2020-21', electricBase: 15.05, electricRate: 0.1029, electricRatePeak: 0.2700, electricRateOffPeak: 0.0636, waterBase: { inside: 5.54, outside: 11.08 }, waterTier1: 4.19, waterTier2: 4.82, waterTier3: 6.49, sewerBase: { inside: 9.89, outside: 19.76 }, sewerRate: 7.06, garbage: 8.72, recycling: 4.89, yardWaste: 7.83, stormwater: { tier1: 0, tier2: 0, tier3: 0, tier4: 0 } },
                        { year: 'FY 2021-22', electricBase: 15.05, electricRate: 0.1029, electricRatePeak: 0.2700, electricRateOffPeak: 0.0636, waterBase: { inside: 5.54, outside: 11.08 }, waterTier1: 4.19, waterTier2: 4.82, waterTier3: 6.49, sewerBase: { inside: 10.04, outside: 20.08 }, sewerRate: 7.17, garbage: 8.94, recycling: 4.98, yardWaste: 7.83, stormwater: { tier1: 1.50, tier2: 5.00, tier3: 7.50, tier4: 10.00 } },
                        { year: 'FY 2022-23', electricBase: 25.00, electricRate: 0.0942, electricRatePeak: 0.195, electricRateOffPeak: 0.0518, waterBase: { inside: 6.00, outside: 12 }, waterTier1: 4.25, waterTier2: 4.89, waterTier3: 6.59, sewerBase: { inside: 10.75, outside: 21.50 }, sewerRate: 7.45, garbage: 9.61, recycling: 4.55, yardWaste: 7.83, stormwater: { tier1: 1.50, tier2: 5.00, tier3: 7.50, tier4: 10.00 } },
                        { year: 'FY 2023-24', electricBase: 26.38, electricRate: 0.0994, electricRatePeak: 0.2057, electricRateOffPeak: 0.0546, waterBase: { inside: 6.00, outside: 12 }, waterTier1: 4.42, waterTier2: 5.09, waterTier3: 6.85, sewerBase: { inside: 11.18, outside: 22.36 }, sewerRate: 7.75, garbage: 9.61, recycling: 5.24, yardWaste: 7.83, stormwater: { tier1: 1.50, tier2: 5.00, tier3: 7.50, tier4: 10.00 } },
                        { year: 'FY 2024-25', electricBase: 26.50, electricRate: 0.1133, electricRatePeak: 0.2345, electricRateOffPeak: 0.0623, waterBase: { inside: 6.24, outside: 12.48 }, waterTier1: 4.6, waterTier2: 5.29, waterTier3: 7.13, sewerBase: { inside: 11.63, outside: 23.26 }, sewerRate: 8.06, garbage: 10.1, recycling: 5.34, yardWaste: 7.83, stormwater: { tier1: 1.50, tier2: 5.00, tier3: 7.50, tier4: 10.00 } },
                        { year: 'FY 2025-26', electricBase: 28.00, electricRate: 0.1178, electricRatePeak: 0.2439, electricRateOffPeak: 0.0648, waterBase: { inside: 6.49, outside: 12.98 }, waterTier1: 4.78, waterTier2: 5.50, waterTier3: 7.41, sewerBase: { inside: 12.09, outside: 24.19 }, sewerRate: 8.38, garbage: 10.35, recycling: 5.44, yardWaste: 7.83, stormwater: { tier1: 1.50, tier2: 5.00, tier3: 7.50, tier4: 10.00 } }
                    ],
                    usageType: 'flat',
                    location: 'inside',
                    houseType: 'pays_stormwater',
                    houseSize: 'tier1',
                    flatUsage: 4000,
                    salesTax: 0.07,
                    peakUsage: 1000,
                    offPeakUsage: 3000,
                    waterUsage: 3000,
                    baseChart: null,
                    meteredChart: null,
                    usageChart: null
                };
            },
            computed: {
                flatElectricalUsage() {
                    return this.usageType === 'flat';
                },
                tieredElectricalUsage() {
                    return this.usageType === 'tiered';
                },
                currentRates() {
                    return this.rateData[this.rateData.length - 1];
                },
                electricBill() {
                    if (this.usageType === 'flat') {
                        return this.currentRates.electricBase + (this.flatUsage * this.currentRates.electricRate);
                    } else {
                        return this.currentRates.electricBase +
                            (this.peakUsage * this.currentRates.electricRatePeak) +
                            (this.offPeakUsage * this.currentRates.electricRateOffPeak);
                    }
                },
                salesTaxBill() {
                    return this.electricBill * this.salesTax;
                },
                waterBill() {
                    const usage = this.waterUsage;
                    let cost = this.location == 'inside' ? this.currentRates.waterBase.inside : this.currentRates.waterBase.outside;

                    if (usage <= 6000) {
                        cost += usage / 1000 * this.currentRates.waterTier1;
                    } else if (usage <= 12000) {
                        cost += 6 * this.currentRates.waterTier1;
                        cost += (usage - 6000) / 1000 * this.currentRates.waterTier2;
                    } else {
                        cost += 6 * this.currentRates.waterTier1;
                        cost += 6 * this.currentRates.waterTier2;
                        cost += (usage - 12000) / 1000 * this.currentRates.waterTier3;
                    }

                    return cost;
                },
                sewerBill() {
                    let base = this.location == 'inside' ? this.currentRates.sewerBase.inside : this.currentRates.sewerBase.outside;
                    return base + (this.waterUsage / 1000 * this.currentRates.sewerRate);
                },
                garbageBill() {
                    return this.currentRates.garbage;
                },
                recyclingBill() {
                    return this.currentRates.recycling;
                },
                yardWasteBill() {
                    return this.currentRates.yardWaste;
                },
                stormwaterBill() {
                    if (this.houseType == 'no_stormwater') {
                        return 0;
                    }
                    switch (this.houseSize) {
                        case 'tier1':
                            return this.currentRates.stormwater.tier1;
                            break;
                        case 'tier2':
                            return this.currentRates.stormwater.tier2;
                            break;
                        case 'tier3':
                            return this.currentRates.stormwater.tier3;
                            break;
                        case 'tier4':
                            return this.currentRates.stormwater.tier4;
                            break;
                    }
                    return 0;
                },
                totalBill() {
                    return this.electricBill + this.salesTaxBill + this.waterBill + this.sewerBill + this.garbageBill + this.recyclingBill + this.yardWasteBill + this.stormwaterBill;
                },
                electricEquation() {
                    if (this.usageType === 'flat') {
                        return `$${this.currentRates.electricBase.toFixed(2)} + $${(this.flatUsage * this.currentRates.electricRate).toFixed(2)} (${this.flatUsage} kWh × $${this.currentRates.electricRate.toFixed(4)}/kWh)`;
                    } else {
                        return `$${this.currentRates.electricBase.toFixed(2)} + $${(this.peakUsage * this.currentRates.electricRatePeak)} (${this.peakUsage} kWh × $${this.currentRates.electricRatePeak.toFixed(4)}/kWh) + $${(this.offPeakUsage * this.currentRates.electricRateOffPeak).toFixed(2)} (${this.offPeakUsage} kWh × $${this.currentRates.electricRateOffPeak.toFixed(3)}/kWh)`;
                    }
                },
                salesTaxEquation() {
                    return `${this.salesTax.toFixed(2)} × $${this.electricBill.toFixed(2)}`;
                },
                waterEquation() {
                    const usage = this.waterUsage;
                    const base = this.location == 'inside' ? this.currentRates.waterBase.inside.toFixed(2) : this.currentRates.waterBase.outside.toFixed(2);
                    const t1 = this.currentRates.waterTier1.toFixed(2);
                    const t2 = this.currentRates.waterTier2.toFixed(2);
                    const t3 = this.currentRates.waterTier3.toFixed(2);

                    if (usage <= 6000) {
                        return `$${base} + $${((usage / 1000) * t1).toFixed(2)} (${(usage / 1000).toFixed(2)} kgal × $${t1}/kgal)`;
                    } else if (usage <= 12000) {
                        return `$${base} + $${(6 * t1 + ((usage - 6000) / 1000) * t2).toFixed(2)} (6.00 kgal × $${t1}/kgal + ${((usage - 6000) / 1000).toFixed(2)} kgal × $${t2}/kgal)`;
                    } else {
                        return `$${base} + $${(6 * t1 + 6 * t2 + ((usage - 12000) / 1000) * t3).toFixed(2)}  (6.00 kgal × $${t1}/kgal + 6.00 kgal × $${t2}/kgal + ${((usage - 12000) / 1000).toFixed(2)} kgal × $${t3}/kgal)`;
                    }
                },
                sewerEquation() {
                    const base = this.location == 'inside' ? this.currentRates.sewerBase.inside.toFixed(2) : this.currentRates.sewerBase.outside.toFixed(2);
                    return `$${base} + $${((this.waterUsage / 1000) * this.currentRates.sewerRate).toFixed(2)}  (${(this.waterUsage / 1000).toFixed(2)} kgal × $${this.currentRates.sewerRate.toFixed(2)}/kgal)`;
                },
                garbageEquation() {
                    return `$${this.currentRates.garbage.toFixed(2)} (flat fee per bill)`;
                },
                recyclingEquation() {
                    return `$${this.currentRates.recycling.toFixed(2)} (flat fee per bill)`;
                },
                yardWasteEquation() {
                    return `$${this.currentRates.yardWaste.toFixed(2)} (flat fee per bill)`;
                },
                stormwaterEquation() {
                    let rate = 0;
                    if (this.houseType == 'pays_stormwater') {
                        switch (this.houseSize) {
                            case 'tier1':
                                rate = this.currentRates.stormwater.tier1;
                                break;
                            case 'tier2':
                                rate = this.currentRates.stormwater.tier2;
                                break;
                            case 'tier3':
                                rate = this.currentRates.stormwater.tier3;
                                break;
                            case 'tier4':
                                rate = this.currentRates.stormwater.tier4;
                                break;
                        }
                    }
                    return `$${rate.toFixed(2)} (flat fee per bill)`;
                }
            },
            mounted() {
                this.createCharts();
            },
            watch: {
                // whenever question changes, this function will run
                usageType(newUsageType, oldUsageType) {
                    this.refreshCharts();
                },
                location(newLocation, oldLocation) {
                    this.refreshCharts();
                },
                houseType(newHouseType, oldHouseType) {
                    this.refreshCharts();
                },
                houseSize(newHouseSize, oldHouseSize) {
                    this.refreshCharts();
                }
            },
            methods: {
                refreshCharts() {
                    this.meteredChart.destroy();
                    this.baseChart.destroy();
                    this.usageChart.destroy();
                    this.createCharts();
                },
                createCharts() {
                    const years = this.rateData.map(d => d.year);
                    // Base Rates Chart
                    const baseCtx = this.$refs.baseRateChart.getContext('2d');
                    this.baseChart = new Chart(baseCtx, {
                        type: 'line',
                        data: {
                            labels: years,
                            datasets: [
                                {
                                    label: 'Electric',
                                    data: this.rateData.map(d => d.electricBase),
                                    borderColor: '#f59e0b',
                                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                    tension: 0
                                },
                                {
                                    label: 'Water',
                                    data: this.location == 'inside' ? this.rateData.map(d => d.waterBase.inside) : this.rateData.map(d => d.waterBase.outside),
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    tension: 0,
                                },
                                {
                                    label: 'Sewer',
                                    data: this.location == 'inside' ? this.rateData.map(d => d.sewerBase.inside) : this.rateData.map(d => d.sewerBase.outside),
                                    borderColor: '#10b981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    tension: 0
                                },
                                {
                                    label: 'Garbage',
                                    data: this.rateData.map(d => d.garbage),
                                    borderColor: '#ff5747',
                                    backgroundColor: 'rgba(255, 221, 212, 0.1)',
                                    tension: 0
                                },
                                {
                                    label: 'Recycling',
                                    data: this.rateData.map(d => d.recycling),
                                    borderColor: '#10b981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    tension: 0
                                },
                                {
                                    label: 'Yard Waste',
                                    data: this.rateData.map(d => d.yardWaste),
                                    borderColor: '#df00ad',
                                    backgroundColor: 'rgba(255, 218, 245, 0.1)',
                                    tension: 0
                                },
                                {
                                    label: 'Stormwater',
                                    data: this.houseType == 'no_stormwater' ? this.rateData.map(d => 0) : this.houseSize == 'tier1' ? this.rateData.map(d => d.stormwater.tier1) : this.houseSize == 'tier2' ? this.rateData.map(d => d.stormwater.tier2) : this.houseSize == 'tier3' ? this.rateData.map(d => d.stormwater.tier3) : this.rateData.map(d => d.stormwater.tier4),
                                    borderColor: '#0891b2',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    tension: 0
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function (context) {
                                            let label = context.dataset.label || '';

                                            if (label) {
                                                label += ': ';
                                            }
                                            if (context.parsed.y !== null) {
                                                label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(context.parsed.y);
                                            }
                                            return label;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Base Rate ($)'
                                    }
                                }
                            }
                        }
                    });

                    // Metered Rates Chart
                    const meteredCtx = this.$refs.meteredRateChart.getContext('2d');
                    this.meteredChart = new Chart(meteredCtx, {
                        type: 'line',
                        data: {
                            labels: years,
                            datasets: [
                                {
                                    label: 'Electric Flat Rate ($/kWh)',
                                    data: this.rateData.map(d => d.electricRate),
                                    borderColor: '#f59e0b',
                                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                    tension: 0
                                },
                                {
                                    label: 'Electric Peak Rate ($/kWh)',
                                    data: this.rateData.map(d => d.electricRatePeak),
                                    borderColor: '#f59e0b',
                                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                    tension: 0,
                                    borderDash: [5, 5]
                                },
                                {
                                    label: 'Electric Off-Peak Rate ($/kWh)',
                                    data: this.rateData.map(d => d.electricRateOffPeak),
                                    borderColor: '#f59e0b',
                                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                    tension: 0,
                                    borderDash: [2, 2]
                                },
                                {
                                    label: 'Water Tier 1 ($/kgal)',
                                    data: this.rateData.map(d => d.waterTier1),
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    tension: 0
                                },
                                {
                                    label: 'Water Tier 2 ($/kgal)',
                                    data: this.rateData.map(d => d.waterTier2),
                                    borderColor: '#60a5fa',
                                    backgroundColor: 'rgba(96, 165, 250, 0.1)',
                                    tension: 0,
                                    borderDash: [5, 5]
                                },
                                {
                                    label: 'Water Tier 3 ($/kgal)',
                                    data: this.rateData.map(d => d.waterTier3),
                                    borderColor: '#93c5fd',
                                    backgroundColor: 'rgba(147, 197, 253, 0.1)',
                                    tension: 0,
                                    borderDash: [2, 2]
                                },
                                {
                                    label: 'Sewer ($/kgal)',
                                    data: this.rateData.map(d => d.sewerRate),
                                    borderColor: '#10b981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    tension: 0
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function (context) {
                                            let label = context.dataset.label || '';

                                            if (label) {
                                                label += ': ';
                                            }
                                            if (context.parsed.y !== null) {
                                                label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(context.parsed.y);
                                            }
                                            return label;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Rate ($/unit)'
                                    }
                                }
                            }
                        }
                    });


                    // Usage costs over time chart
                    const sameUsageCtx = this.$refs.sameUsageOverYearsChart.getContext('2d');
                    this.usageChart = new Chart(sameUsageCtx, {
                        type: 'line',
                        data: {
                            labels: years,
                            datasets: [
                                {
                                    label: 'Total',
                                    data: this.rateData.map(d => d.electricBase + this.flatUsage * d.electricRate + (this.location == 'inside' ? d.waterBase.inside : d.waterBase.outside) + (Math.min(6000, this.waterUsage) / 1000) * d.waterTier1 + (Math.max(0, this.waterUsage - 6000) / 1000) * d.waterTier2 + (Math.max(0, this.waterUsage - 12000) / 1000) * d.waterTier3 + (this.location == 'inside' ? d.sewerBase.inside : d.sewerBase.outside) + (Math.min(6000, this.waterUsage) / 1000) * d.sewerRate + d.garbage + d.recycling + d.yardWaste + (this.houseType == 'no_stormwater' ? 0 : this.houseSize == 'tier1' ? d.stormwater.tier1 : this.houseSize == 'tier2' ? d.stormwater.tier2 : this.houseSize == 'tier3' ? d.stormwater.tier3 : d.stormwater.tier4)),
                                    borderColor: '#4f46e5',
                                    backgroundColor: 'rgba(45, 158, 11, 0.1)',
                                    tension: 0
                                },
                                {
                                    label: 'Electric',
                                    data: this.rateData.map(d => d.electricBase + this.flatUsage * d.electricRate),
                                    borderColor: '#f59e0b',
                                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                    tension: 0
                                },
                                {
                                    label: 'Water',
                                    data: this.rateData.map(d => (this.location == 'inside' ? d.waterBase.inside : d.waterBase.outside) + (Math.min(6000, this.waterUsage) / 1000) * d.waterTier1 + (Math.max(0, this.waterUsage - 6000) / 1000) * d.waterTier2 + (Math.max(0, this.waterUsage - 12000) / 1000) * d.waterTier3),
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    tension: 0
                                },
                                {
                                    label: 'Sewer',
                                    data: this.rateData.map(d => d.sewerRate),
                                    data: this.rateData.map(d => (this.location == 'inside' ? d.sewerBase.inside : d.sewerBase.outside) + (Math.min(6000, this.waterUsage) / 1000) * d.sewerRate),

                                    borderColor: '#10b981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    tension: 0
                                },
                                {
                                    label: 'Other (Garbage + Recycling + Yard Waste + Stormwater)',
                                    data: this.rateData.map(d => d.garbage + d.recycling + d.yardWaste + (this.houseType == 'no_stormwater' ? 0 : this.houseSize == 'tier1' ? d.stormwater.tier1 : this.houseSize == 'tier2' ? d.stormwater.tier2 : this.houseSize == 'tier3' ? d.stormwater.tier3 : d.stormwater.tier4)),
                                    borderColor: '#df00ad',
                                    backgroundColor: 'rgba(255, 218, 245, 0.1)',
                                    tension: 0
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function (context) {
                                            let label = context.dataset.label || '';

                                            if (label) {
                                                label += ': ';
                                            }
                                            if (context.parsed.y !== null) {
                                                label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(context.parsed.y);
                                            }
                                            return label;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Estimated $'
                                    }
                                }
                            }
                        }
                    });

                }
            }
        }).mount('#app');
    </script>
</body>

</html>